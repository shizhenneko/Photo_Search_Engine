# 方案：强化 Elasticsearch 关键字检索能力

## 目标
不再依赖内存降级，而是通过修正 ES 查询逻辑和利用其全文检索能力，确保“夏天”能作为关键字在 ES 中被正确检索。

## 技术实现逻辑

### 1. 修正 ES 过滤器的字段指向
针对当前 ES 中 `season` 等字段为 `text` 类型的情况，在查询时显式指向其 `.keyword` 子字段。
*   **修改点**：`utils/keyword_store.py`
*   **动作**：将 `filter` 中的 `{"term": {"season": "夏天"}}` 改为 `{"term": {"season.keyword": "夏天"}}`。

### 2. 启用“过滤+关键字”复合检索
即使是所谓的“纯过滤查询”（如“夏天的照片”），也将原始文本传给 ES，让 ES 同时执行全文搜索和条件过滤。
*   **修改点**：`core/searcher.py`
*   **动作**：在 `_filter_only_search` 中，调用 `keyword_store.search_with_filters` 时，参数由 `query=None` 改为 `query=query`。

### 3. 优化相关性评分
让 ES 的 `_score` 真正体现关键字匹配的价值。

## 实施步骤
1.  **修改 `utils/keyword_store.py`**：增加对 `.keyword` 后缀的自动处理逻辑，提升查询兼容性。
2.  **修改 `core/searcher.py`**：在纯过滤模式下注入原始查询文本，激活 ES 的相关性检索。
3.  **移除之前的内存降级日志**（或将其作为最后的保底，但不作为首选）。
4.  **运行验证脚本**：通过 `curl` 或 Python 脚本确认 ES 现在能基于关键字和过滤返回结果。

## 预期效果
*   搜索“夏天的照片”时，ES 将返回 `season` 为夏天且 `description` 中包含“夏天”相关语义的照片。
*   完全利用 ES 的分布式检索能力，不再受限于内存处理。
